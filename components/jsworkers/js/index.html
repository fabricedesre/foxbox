<html>
  <head>
    <script src="objectencoder.js"> </script>
    <script src="remoteworkers.js"> </script>
    <style>
.error {
  color: red;
}
    </style>
    <script>
var worker;

function formatError(event) {
  return `${event.message} @ <a href="view-source:${event.filename}">${event.filename}:${event.lineno}:${event.colno}</a>`;
}

function test() {
  console.log("Starting test...");
  document.getElementById("inout").removeAttribute("style");
  FoxboxWorkers.set_base_url("http://localhost:3000");
  worker = FoxboxWorkers.Worker("http://localhost:8000/worker1.js");
  worker.addEventListener("message", function(event) {
    document.getElementById("output").innerHTML += ">> " + event.data + "\n";
  });
  worker.addEventListener("error", function(event) {
    document.getElementById("output").innerHTML += "<span class=error>>> !! " + formatError(event) + "</span>\n";
  });
}

function send() {
  let input = document.getElementById("input");
  var text = input.value;
  input.value = "";
  worker.postMessage(text);
  document.getElementById("output").innerHTML += "<< " + text + "\n";
}
    </script>
  </head>
  <body>
    <h1>RemoteWorkers sandbox</h1>
    <button onclick="test()">Start</button>
    <div id="inout" style="display:none;">
      <input type="text" id="input"></input><button onclick="send()">Send</button>
      <pre id="output"></pre>
    </div>
  </body>
</html>
