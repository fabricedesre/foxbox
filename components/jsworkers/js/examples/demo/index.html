<html>
  <head>
    <script src="/lib/objectencoder.js"> </script>
    <script src="/lib/remoteworkers.js"> </script>
    <style>
.error {
  color: red;
}
    </style>
    <script>
var worker;

function formatError(event) {
  return `${event.message} @ <a href="${event.filename}">${event.filename}:${event.lineno}:${event.colno}</a>`;
}

function test() {
  console.log("Starting test...");
  document.getElementById("inout").removeAttribute("style");
  FoxboxWorkers.set_base_url("http://localhost:3000");
  worker = FoxboxWorkers.Worker("http://localhost:8000/examples/demo/worker1.js");
  worker.addEventListener("message", function(event) {
    document.getElementById("output").innerHTML += ">> " + event.data + "\n";
  });
  worker.addEventListener("error", function(event) {
    document.getElementById("output").innerHTML += "<span class=error>>> !! " + formatError(event) + "</span>\n";
  });
}

function send() {
  var input = document.getElementById("input");
  var text = input.value;
  input.value = "";
  worker.postMessage(text);
  document.getElementById("output").innerHTML += "<< " + text + "\n";
}

function register() {
  FoxboxWorkers.set_base_url("http://localhost:3000");
  var url = document.getElementById("sw_url").value;
  var options = document.getElementById("sw_options").value.trim() || {};
  FoxboxWorkers.RegisterServiceWorker(url, JSON.parse(options))
               .then(console.log, console.error);
}
    </script>
  </head>
  <body>
    <h1>ServiceWorkers demo</h1>
    <p>Register service worker:</p>
    <div>
      URL <input type="text" id="sw_url"></input>
      Options <input type="text" id="sw_options"></input>
      <button onclick="register()">Register</button>
    </div>
    <hr/>
    <h1>RemoteWorkers demo</h1>
    <button onclick="test()">Start</button>
    <div id="inout" style="display:none;">
      <input type="text" id="input"></input><button onclick="send()">Send</button>
      <pre id="output"></pre>
    </div>
  </body>
</html>
